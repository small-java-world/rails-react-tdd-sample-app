# 動的実行ガイド生成ルール（/kairo-tasks 後処理用）

この文書は、`/kairo-tasks` がタスクファイルを生成した**後**に適用されるルールを定義します。

## 目的
生成されたタスクファイルに対し、**その内容に応じた動的な**時系列実行ガイドを追記し、開発者の作業を効率化する。

## 手順

1.  **生成されたタスクの解析**:
    - `/kairo-tasks` が生成したタスクファイル（例: `docs/tasks/feature-x-tasks.md`）を特定する。
    - ファイル内から、すべてのタスク見出し（例: `#### TASK-001: 〇〇を実装`）をリストアップする。
    - 各タスクから「タスクID」と「タスク名」を抽出する。

2.  **動的実行ガイドの生成**:
    - 抽出した**各タスクごと**に、以下のTDDコマンドシーケンスを生成する。
    - 各コマンドには、その**タスク名を反映した具体的なESC追記ヒント**を添えること。

3.  **最終セクションの構築**:
    - 全タスク分のガイドを `## tsumiki 時系列実行ガイド（動的生成）` という一つのセクションにまとめる。
    - 冪等性のため、セクション全体を `<!-- BEGIN TSUMIKI DYNAMIC RUNBOOK -->` と `<!-- END TSUMIKI DYNAMIC RUNBOOK -->` で囲む。
    - **生成される内容の例（1タスク分）**:
      ```markdown
      ### TASK-001: 〇〇を実装

      1.  **/tdd-red**
          - `claude -p "/tdd-red"`
          - **ESC追記ヒント:** "TASK-001: 〇〇を実装 の失敗するテストを作成してください。"
      2.  **/tdd-green** (+ jscpd)
          - `claude -p "/tdd-green-with-jscpd"`
          - **ESC追記ヒント:** "TASK-001: 〇〇を実装 を最小限のコードでGreenにしてください。"
      3.  **/tdd-refactor** (+ jscpd)
          - `claude -p "/tdd-refactor-with-jscpd"`
          - **ESC追記ヒント:** "TASK-001: 〇〇を実装 の実装をリファクタリングしてください。"
      ```

4.  **タスクファイルへの挿入**:
    - 生成したガイドのセクション全体を、タスクファイル内の `## 実行順序` という見出しの**直前**に挿入する。
    - もし `<!-- BEGIN TSUMIKI DYNAMIC RUNBOOK -->` 区間が既に存在する場合は、その中身を完全に**上書き**すること。
